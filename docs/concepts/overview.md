# ğŸ” Kubernetesæ¦‚è¦

Kubernetesã‚’ç†è§£ã™ã‚‹ãŸã‚ã®å‡ºç™ºç‚¹ã¨ã—ã¦ã€ãã®åŸºæœ¬çš„ãªç‰¹å¾´ã€åˆ©ç‚¹ã€ãã—ã¦AWS ECSã¨ã®æ¯”è¼ƒã‚’å­¦ç¿’ã—ã¾ã™ã€‚

## ğŸ¯ ã“ã®ç« ã§å­¦ã¶ã“ã¨

- Kubernetesã¨ã¯ä½•ã‹ã€ãªãœå¿…è¦ãªã®ã‹
- AWS ECSã¨ã®æ ¹æœ¬çš„ãªé•ã„ã¨é¡ä¼¼ç‚¹
- ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é€²åŒ–
- Kubernetesã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®ç†è§£

## ğŸš€ Kubernetesã¨ã¯

Kubernetesã¯ã€ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã€ç®¡ç†ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

### æ ¸ã¨ãªã‚‹ç‰¹å¾´

| ç‰¹å¾´ | èª¬æ˜ | AWS ECSã¨ã®æ¯”è¼ƒ |
|------|------|-----------------|
| **å®£è¨€çš„è¨­å®š** | ã‚ã‚‹ã¹ãçŠ¶æ…‹ã‚’YAMLã§å®šç¾© | Task Definitionã¨é¡ä¼¼ã€ã‚ˆã‚ŠæŸ”è»Ÿ |
| **è‡ªå‹•ä¿®å¾©** | å¤±æ•—ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’è‡ªå‹•å†èµ·å‹• | ECSã‚µãƒ¼ãƒ“ã‚¹ã®è‡ªå‹•å¾©æ—§ã¨åŒç­‰ |
| **æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°** | è² è·ã«å¿œã˜ã¦Podæ•°ã‚’è‡ªå‹•èª¿æ•´ | Auto Scalingã¨åŒç­‰ã€ã‚ˆã‚Šç´°ã‹ã„åˆ¶å¾¡ |
| **ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒª** | å†…è”µDNSã€è‡ªå‹•ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚° | Service Discoveryã‚ˆã‚Šé«˜æ©Ÿèƒ½ |
| **ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ** | ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã—ã§ã‚¢ãƒ—ãƒªæ›´æ–° | ECSã‚µãƒ¼ãƒ“ã‚¹æ›´æ–°ã¨åŒç­‰ |
| **è¨­å®šç®¡ç†** | ConfigMapã€Secretã§è¨­å®šåˆ†é›¢ | Parameter Storeç›¸å½“ã€ã‚ˆã‚Šçµ±åˆçš„ |

### ãªãœKubernetesãªã®ã‹ï¼Ÿ

#### 1. ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£
```yaml
# åŒã˜ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã§å‹•ä½œ
---
# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
apiVersion: v1
kind: Deployment
---
# ã‚¯ãƒ©ã‚¦ãƒ‰æœ¬ç•ªç’°å¢ƒ
# åŒã˜è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨å¯èƒ½
```

#### 2. ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£
```bash
# ç°¡å˜ãªã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
kubectl scale deployment my-app --replicas=10

# è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
kubectl autoscale deployment my-app --min=2 --max=10 --cpu-percent=80
```

#### 3. æ‹¡å¼µæ€§
```yaml
# ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®å®šç¾©
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: applications.example.com
```

## ğŸ†š AWS ECS vs Kubernetes è©³ç´°æ¯”è¼ƒ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¯”è¼ƒ

#### AWS ECS
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ECS Cluster          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚EC2/Farg â”‚ â”‚EC2/Farg â”‚ â”‚
â”‚  â”‚Instance â”‚ â”‚Instance â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚Task â”‚ â”‚ â”‚ â”‚Task â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Kubernetes
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kubernetes Cluster     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Worker   â”‚ â”‚Worker   â”‚ â”‚
â”‚  â”‚Node     â”‚ â”‚Node     â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚ Pod â”‚ â”‚ â”‚ â”‚ Pod â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç®¡ç†æ–¹å¼ã®é•ã„

#### AWS ECS: ã‚µãƒ¼ãƒ“ã‚¹ä¸­å¿ƒ
```json
{
  "taskDefinition": "my-app:1",
  "serviceName": "my-service",
  "desiredCount": 3,
  "loadBalancers": [...]
}
```

#### Kubernetes: å®£è¨€çš„ç®¡ç†
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    spec:
      containers:
      - name: app
        image: my-app:1.0
```

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ã®é•ã„

#### AWS ECS
- ALB/NLBã«ã‚ˆã‚‹å¤–éƒ¨å…¬é–‹
- Service Discoveryã«ã‚ˆã‚‹å†…éƒ¨é€šä¿¡
- Security Groupsã«ã‚ˆã‚‹åˆ¶å¾¡

#### Kubernetes
- Serviceã«ã‚ˆã‚‹å†…éƒ¨å…¬é–‹
- Ingressã«ã‚ˆã‚‹å¤–éƒ¨å…¬é–‹
- NetworkPolicyã«ã‚ˆã‚‹åˆ¶å¾¡

```yaml
# Service: å†…éƒ¨é€šä¿¡
apiVersion: v1
kind: Service
metadata:
  name: my-app-service
spec:
  selector:
    app: my-app
  ports:
  - port: 80
    targetPort: 8080
---
# Ingress: å¤–éƒ¨å…¬é–‹
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-app-ingress
spec:
  rules:
  - host: my-app.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: my-app-service
            port:
              number: 80
```

## ğŸŒŸ Kubernetesã®åˆ©ç‚¹

### 1. ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³å›é¿
- è¤‡æ•°ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§å‹•ä½œ
- ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç’°å¢ƒã§ã‚‚åŒã˜è¨­å®š
- æ¨™æº–åŒ–ã•ã‚ŒãŸAPI

### 2. è±Šå¯Œãªã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ 
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†**: Helm
- **è¨­å®šç®¡ç†**: Kustomize
- **CI/CD**: ArgoCDã€Tekton
- **ç›£è¦–**: Prometheusã€Grafana
- **ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥**: Istioã€Linkerd

### 3. è©³ç´°ãªåˆ¶å¾¡
```yaml
# ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
resources:
  requests:
    memory: "64Mi"
    cpu: "250m"
  limits:
    memory: "128Mi"
    cpu: "500m"

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
    - ALL

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
```

## ğŸ¯ AWS ECSç®¡ç†è€…ã¸ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰

### æ—¢å­˜ã®çŸ¥è­˜ã®æ´»ç”¨

| ã‚ãªãŸã®çŸ¥è­˜ | Kubernetesã§ã®å¯¾å¿œ | å­¦ç¿’ã®ãƒã‚¤ãƒ³ãƒˆ |
|-------------|------------------|---------------|
| **Task Definition** | **PodSpec** | YAMLã®æ›¸ãæ–¹ã‚’å­¦ç¿’ |
| **ECS Service** | **Deployment** | å®£è¨€çš„ç®¡ç†ã®æ¦‚å¿µ |
| **ALBè¨­å®š** | **Ingress** | ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®æ´»ç”¨ |
| **CloudFormation** | **Helm/Kustomize** | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã®æ‰‹æ³• |
| **CloudWatch** | **Prometheus** | ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨­è¨ˆã®é•ã„ |
| **Parameter Store** | **ConfigMap/Secret** | è¨­å®šã®åˆ†é›¢æ–¹æ³• |

### å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

#### Week 1: åŸºæœ¬æ¦‚å¿µ
1. ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç†è§£
2. Podã€Serviceã€Deploymentã®é–¢ä¿‚
3. kubectlåŸºæœ¬æ“ä½œ

#### Week 2: å®Ÿè·µé–‹å§‹
1. ç°¡å˜ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤
2. è¨­å®šç®¡ç†ã¨Secretç®¡ç†
3. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®è¨­å®š

#### Week 3: é‹ç”¨é¢
1. ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ã¨Ingress
2. ç›£è¦–ã¨ãƒ­ã‚°è¨­å®š
3. ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°è¨­å®š

#### Week 4: å¿œç”¨æŠ€è¡“
1. Helmãƒãƒ£ãƒ¼ãƒˆä½œæˆ
2. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰
3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

## ğŸ”§ å®Ÿè·µã§é‡è¦ãªæ¦‚å¿µ

### 1. å®£è¨€çš„ç®¡ç†
```bash
# æœ›ã¾ã—ã„çŠ¶æ…‹ã‚’å®£è¨€
kubectl apply -f deployment.yaml

# ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèª
kubectl get deployment my-app

# å·®åˆ†ã‚’ç¢ºèª
kubectl diff -f deployment.yaml
```

### 2. ãƒ©ãƒ™ãƒ«ã¨ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼
```yaml
# ãƒ©ãƒ™ãƒ«ã®å®šç¾©
metadata:
  labels:
    app: my-app
    version: v1.0
    environment: production

# ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã§ã®é¸æŠ
selector:
  matchLabels:
    app: my-app
```

### 3. åå‰ç©ºé–“ã«ã‚ˆã‚‹åˆ†é›¢
```bash
# é–‹ç™ºç’°å¢ƒ
kubectl create namespace development

# æœ¬ç•ªç’°å¢ƒ
kubectl create namespace production

# ç’°å¢ƒåˆ¥ãƒ‡ãƒ—ãƒ­ã‚¤
kubectl apply -f app.yaml -n development
```

## ğŸš¨ æ³¨æ„ã™ã¹ãé•ã„

### 1. çŠ¶æ…‹ç®¡ç†
- **ECS**: ã‚µãƒ¼ãƒ“ã‚¹ãŒæœ›ã¾ã—ã„çŠ¶æ…‹ã‚’ç®¡ç†
- **Kubernetes**: è¤‡æ•°ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒå”èª¿ã—ã¦ç®¡ç†

### 2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°
- **ECS**: VPCãƒã‚¤ãƒ†ã‚£ãƒ–ã€Security Groups
- **Kubernetes**: Overlay Networkã€NetworkPolicy

### 3. æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **ECS**: EBS/EFSã‚’ã‚¿ã‚¹ã‚¯ã«ã‚¢ã‚¿ãƒƒãƒ
- **Kubernetes**: PV/PVCã«ã‚ˆã‚‹æŠ½è±¡åŒ–

## ğŸ“š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **[ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](./cluster-architecture.md)** - è©³ç´°ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç†è§£
2. **[ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰](./workloads.md)** - Podã€Deploymentã€Serviceã®è©³ç´°
3. **[ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](../tutorials/)** - å®Ÿéš›ã®æ“ä½œä½“é¨“

## ğŸ¯ å­¦ç¿’ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ

- [ ] Kubernetesã®åŸºæœ¬çš„ãªåˆ©ç‚¹ã‚’èª¬æ˜ã§ãã‚‹
- [ ] AWS ECSã¨ã®ä¸»è¦ãªé•ã„ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] å®£è¨€çš„ç®¡ç†ã®æ¦‚å¿µã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] è‡ªåˆ†ã®å­¦ç¿’è¨ˆç”»ã‚’ç«‹ã¦ã‚‰ã‚Œã‚‹
- [ ] æ¬¡ã«å­¦ã¶ã¹ãæ¦‚å¿µãŒæ˜ç¢ºã«ãªã£ã¦ã„ã‚‹

---

**æ¬¡ã¸**: [ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](./cluster-architecture.md) | **å®Ÿè·µ**: [Hello Kubernetesãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](../tutorials/hello-kubernetes.md)
