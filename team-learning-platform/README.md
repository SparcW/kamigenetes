# ğŸ“ ãƒãƒ¼ãƒ å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­è¨ˆæ›¸

## ğŸ“– æ¦‚è¦

æ—¢å­˜ã®markdown-serverã‚’æ‹¡å¼µã—ã€ãƒãƒ¼ãƒ å˜ä½ã§ã®Kuberneteså­¦ç¿’ã‚’æ”¯æ´ã™ã‚‹åŒ…æ‹¬çš„ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

## ğŸ¯ ä¸»è¦æ©Ÿèƒ½

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒãƒ¼ãƒ ç®¡ç†
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»èªè¨¼**: ID/Password + OAuth2.0 (Google/GitHub)
- **ãƒãƒ¼ãƒ ç®¡ç†**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒãƒ¼ãƒ æ‰€å±ç®¡ç†
- **æ¨©é™ç®¡ç†**: ã‚¹ãƒ¼ãƒ‘ãƒ¼ç®¡ç†è€… / ãƒãƒ¼ãƒ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ / ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼

### 2. å­¦ç¿’é€²æ—ç®¡ç†
- **èª­æ›¸é€²æ—**: ãƒšãƒ¼ã‚¸å˜ä½ã®é€²æ—è¿½è·¡ãƒ»æ»åœ¨æ™‚é–“è¨ˆæ¸¬
- **ãŠæ°—ã«å…¥ã‚Š**: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ©Ÿèƒ½ãƒ»â˜…è¡¨ç¤º
- **é€²æ—ãƒãƒ¼**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—è¡¨ç¤º

### 3. ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰
- **å€‹äººé€²æ—**: è‡ªåˆ†ã®å­¦ç¿’çŠ¶æ³
- **ãƒãƒ¼ãƒ æ¯”è¼ƒ**: ãƒãƒ¼ãƒ å†…ãƒ¡ãƒ³ãƒãƒ¼ã®é€²æ—
- **å…¨ä½“çµ±è¨ˆ**: å…¨ãƒãƒ¼ãƒ ã®ç¿’ç†Ÿåº¦æ¯”è¼ƒ

### 4. ç¿’ç†Ÿåº¦ã‚·ã‚¹ãƒ†ãƒ 
- **5æ®µéšè©•ä¾¡**: â˜…0(æœªèª­) ï½ â˜…5(å®Œå…¨ç¿’å¾—)
- **3ç¨®é¡ã®è©¦é¨“**:
  - æ¦‚å¿µè©¦é¨“: é¸æŠå¼ã‚¯ã‚¤ã‚º
  - æœºä¸Šè©¦é¨“: YAMLè¨˜è¿°è©¦é¨“
  - å®ŸæŠ€è©¦é¨“: kubectlæ“ä½œå®Ÿç¿’

### 5. ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- **çµ±è¨ˆå¯è¦–åŒ–**: Chart.js/D3.jsã«ã‚ˆã‚‹ã‚°ãƒ©ãƒ•è¡¨ç¤º
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: ç™»éŒ²ãƒ»å‰Šé™¤ãƒ»ãƒãƒ¼ãƒ ç·¨é›†
- **å­¦ç¿’åˆ†æ**: é€²æ—ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰:**
- React 18 + TypeScript
- Material-UI v5
- Chart.js + D3.js
- React Router v6

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰:**
- Node.js + Express + TypeScript
- Passport.js (èªè¨¼)
- Prisma ORM

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:**
- PostgreSQL 15 (æ°¸ç¶šãƒ‡ãƒ¼ã‚¿)
- Redis 7 (ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥)

**ã‚¤ãƒ³ãƒ•ãƒ©:**
- Docker + Kubernetes
- Minikube (é–‹ç™ºç’°å¢ƒ)

### ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹æ§‹æˆ

```mermaid
graph TB
    subgraph "Frontend Layer"
        Web[React Web App]
        Mobile[Mobile App]
    end
    
    subgraph "API Gateway"
        Gateway[Express API Gateway]
    end
    
    subgraph "Microservices"
        Auth[èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹]
        User[ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†]
        Team[ãƒãƒ¼ãƒ ç®¡ç†]
        Progress[é€²æ—ç®¡ç†]
        Exam[è©¦é¨“ã‚µãƒ¼ãƒ“ã‚¹]
        Analytics[åˆ†æã‚µãƒ¼ãƒ“ã‚¹]
        Docs[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé…ä¿¡]
    end
    
    subgraph "Data Layer"
        PostgreSQL[(PostgreSQL)]
        Redis[(Redis)]
        Files[Document Files]
    end
    
    Web --> Gateway
    Mobile --> Gateway
    Gateway --> Auth
    Gateway --> User
    Gateway --> Team
    Gateway --> Progress
    Gateway --> Exam
    Gateway --> Analytics
    Gateway --> Docs
    
    Auth --> Redis
    User --> PostgreSQL
    Team --> PostgreSQL
    Progress --> PostgreSQL
    Progress --> Redis
    Exam --> PostgreSQL
    Analytics --> PostgreSQL
    Analytics --> Redis
    Docs --> Files
```

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### PostgreSQL ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒãƒ¼ãƒ é–¢é€£
```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255), -- NULL for OAuth users
    display_name VARCHAR(100) NOT NULL,
    avatar_url TEXT,
    role user_role NOT NULL DEFAULT 'user',
    oauth_provider VARCHAR(20), -- 'google', 'github', etc.
    oauth_id VARCHAR(100),
    is_active BOOLEAN DEFAULT true,
    last_login_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ãƒãƒ¼ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE teams (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    created_by UUID REFERENCES users(id),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—
CREATE TABLE team_memberships (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    team_id UUID REFERENCES teams(id),
    role team_role DEFAULT 'member',
    joined_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, team_id)
);

-- æ¨©é™å®šç¾©
CREATE TYPE user_role AS ENUM ('super_admin', 'team_manager', 'user');
CREATE TYPE team_role AS ENUM ('manager', 'member');
```

#### å­¦ç¿’é€²æ—é–¢é€£
```sql
-- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±
CREATE TABLE documents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    file_path TEXT UNIQUE NOT NULL,
    title VARCHAR(200) NOT NULL,
    category VARCHAR(100),
    estimated_reading_time INTEGER, -- minutes
    difficulty_level INTEGER CHECK (difficulty_level BETWEEN 1 AND 5),
    prerequisites TEXT[], -- array of document IDs
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- èª­æ›¸é€²æ—
CREATE TABLE reading_progress (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    document_id UUID REFERENCES documents(id),
    progress_percentage DECIMAL(5,2) CHECK (progress_percentage BETWEEN 0 AND 100),
    total_reading_time INTEGER DEFAULT 0, -- seconds
    last_position INTEGER DEFAULT 0, -- scroll position
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, document_id)
);

-- ãŠæ°—ã«å…¥ã‚Š
CREATE TABLE favorites (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    document_id UUID REFERENCES documents(id),
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, document_id)
);
```

#### ç¿’ç†Ÿåº¦ãƒ»è©¦é¨“é–¢é€£
```sql
-- è©¦é¨“ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE exams (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    document_id UUID REFERENCES documents(id),
    title VARCHAR(200) NOT NULL,
    exam_type exam_type NOT NULL,
    description TEXT,
    time_limit INTEGER, -- minutes
    passing_score DECIMAL(5,2),
    max_attempts INTEGER DEFAULT 3,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- è©¦é¨“å•é¡Œ
CREATE TABLE exam_questions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    exam_id UUID REFERENCES exams(id),
    question_type question_type NOT NULL,
    question_text TEXT NOT NULL,
    expected_answer TEXT,
    options JSONB, -- for multiple choice
    points INTEGER DEFAULT 1,
    order_index INTEGER,
    created_at TIMESTAMP DEFAULT NOW()
);

-- è©¦é¨“çµæœ
CREATE TABLE exam_attempts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    exam_id UUID REFERENCES exams(id),
    score DECIMAL(5,2),
    total_points INTEGER,
    time_taken INTEGER, -- seconds
    answers JSONB,
    kubectl_logs TEXT, -- for practical exams
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW()
);

-- ç¿’ç†Ÿåº¦
CREATE TABLE proficiency_levels (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    document_id UUID REFERENCES documents(id),
    level INTEGER CHECK (level BETWEEN 0 AND 5),
    concept_score DECIMAL(5,2),
    practical_score DECIMAL(5,2),
    yaml_score DECIMAL(5,2),
    last_updated TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, document_id)
);

-- åˆ—æŒ™å‹å®šç¾©
CREATE TYPE exam_type AS ENUM ('concept', 'yaml', 'practical');
CREATE TYPE question_type AS ENUM ('multiple_choice', 'yaml_generation', 'kubectl_command');
```

### Redis ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆ

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
```
sess:{sessionId} = {
    userId: UUID,
    username: string,
    role: string,
    teamIds: UUID[],
    lastActivity: timestamp,
    expiresAt: timestamp
}
```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
```
# ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚­ãƒ£ãƒƒã‚·ãƒ¥
user:{userId} = JSON user data (TTL: 1 hour)

# ãƒãƒ¼ãƒ æƒ…å ±ã‚­ãƒ£ãƒƒã‚·ãƒ¥
team:{teamId} = JSON team data (TTL: 30 minutes)

# ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥
leaderboard:team:{teamId} = JSON sorted progress data (TTL: 5 minutes)
leaderboard:global = JSON global stats (TTL: 10 minutes)

# ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼
active_users = SET of userIds (TTL: 15 minutes)

# è©¦é¨“é€²è¡ŒçŠ¶æ³
exam_session:{userId}:{examId} = {
    startTime: timestamp,
    answers: {},
    timeRemaining: integer
} (TTL: exam time limit)
```

## ğŸ“‹ APIè¨­è¨ˆ

### èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† API
```
POST /api/auth/login
POST /api/auth/logout
POST /api/auth/oauth/{provider}
GET  /api/auth/me

GET    /api/users
POST   /api/users
GET    /api/users/{id}
PUT    /api/users/{id}
DELETE /api/users/{id}
```

### ãƒãƒ¼ãƒ ç®¡ç† API
```
GET    /api/teams
POST   /api/teams
GET    /api/teams/{id}
PUT    /api/teams/{id}
DELETE /api/teams/{id}
POST   /api/teams/{id}/members
DELETE /api/teams/{id}/members/{userId}
```

### å­¦ç¿’é€²æ— API
```
GET    /api/documents
GET    /api/documents/{id}
GET    /api/progress
POST   /api/progress
PUT    /api/progress/{documentId}

GET    /api/favorites
POST   /api/favorites
DELETE /api/favorites/{documentId}
```

### ç¿’ç†Ÿåº¦ãƒ»è©¦é¨“ API
```
GET    /api/exams
GET    /api/exams/{id}
POST   /api/exams/{id}/attempts
GET    /api/proficiency
GET    /api/proficiency/{documentId}
```

### ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ API
```
GET /api/leaderboard/team/{teamId}
GET /api/leaderboard/global
GET /api/analytics/team/{teamId}
GET /api/analytics/user/{userId}
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### èªè¨¼ãƒ»èªå¯
- **JWT**: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ (15åˆ†æœ‰åŠ¹)
- **Redis**: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ (7æ—¥æœ‰åŠ¹)
- **RBAC**: ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **OAuth2.0**: Google/GitHubé€£æº

### ãƒ‡ãƒ¼ã‚¿ä¿è­·
- **æš—å·åŒ–**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯bcryptã§ãƒãƒƒã‚·ãƒ¥åŒ–
- **HTTPS**: é€šä¿¡ã®æš—å·åŒ–
- **CORS**: ã‚ªãƒªã‚¸ãƒ³åˆ¶é™
- **Rate Limiting**: APIå‘¼ã³å‡ºã—åˆ¶é™

## ğŸš€ é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºç›¤æ§‹ç¯‰ (1-2é€±é–“)
- [ ] Dockerç’°å¢ƒæ§‹ç¯‰ (PostgreSQL + Redis)
- [ ] åŸºæœ¬APIæ§‹é€ æ§‹ç¯‰
- [ ] èªè¨¼ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…

### Phase 2: ã‚³ã‚¢æ©Ÿèƒ½ (2-3é€±é–“)
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒãƒ¼ãƒ ç®¡ç†
- [ ] èª­æ›¸é€²æ—è¿½è·¡
- [ ] ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½

### Phase 3: ç¿’ç†Ÿåº¦ã‚·ã‚¹ãƒ†ãƒ  (2-3é€±é–“)
- [ ] è©¦é¨“ã‚¨ãƒ³ã‚¸ãƒ³
- [ ] YAMLè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ 
- [ ] å®ŸæŠ€è©¦é¨“ãƒ­ã‚°è§£æ

### Phase 4: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (1-2é€±é–“)
- [ ] React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- [ ] Chart.js ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–
- [ ] ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰

### Phase 5: æœ€é©åŒ–ãƒ»ãƒ†ã‚¹ãƒˆ (1é€±é–“)
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

---

**ğŸ“… æ›´æ–°æ—¥**: 2025å¹´7æœˆ3æ—¥ | **ğŸ‘¥ å¯¾è±¡**: Kuberneteså­¦ç¿’ãƒãƒ¼ãƒ  | **ğŸ¯ ç›®æ¨™**: ãƒãƒ¼ãƒ å­¦ç¿’åŠ¹ç‡åŒ–
